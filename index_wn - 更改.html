<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>2WAI Demo</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
	<link rel="stylesheet" href="swiper.min.css">
	
    <style>
    /* 添加在style标签最前面，设置全局字体 */
    * {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    .outer-container {
        max-width: 1200px;
        margin: 30px auto;
        background: #ffffff;
        border-radius: 20px;
        box-shadow: 0 8px 30px rgba(0,0,0,0.08);
        padding: 25px;
        border: none;
    }

    .main-title {
        margin: -25px -25px 30px -25px;
        border-radius: 20px 20px 0 0;
        text-align: center;
        padding: 25px;
        background: linear-gradient(135deg, #4568dc, #b06ab3);
        color: white;
    }

    .main-title h1 {
        margin: 0;
        font-size: 28px;
        font-weight: 600;
        letter-spacing: 0.5px;
        font-family: "SF Pro Display", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }

    .control-panel {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
        flex-wrap: wrap;
    }

    .btn {
        padding: 10px 20px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        font-size: 14px;
    }

    .btn-primary {
        background: linear-gradient(135deg, #4568dc, #b06ab3);
        color: white;
    }

    .btn-primary:hover {
        background: linear-gradient(135deg, #3f5bd3, #a055a8);
        transform: translateY(-1px);
    }

    .btn-secondary {
        background-color: #2196F3;
        color: white;
    }

    .btn-secondary:hover {
        background-color: #1e88e5;
    }

    .chat-container {
	   flex: 1;
       min-height: 0;
       max-height: none;
       border: none;
       background-color: #f2f2f2;
       padding: 20px;
       box-shadow: inset 0 2px 10px rgba(0,0,0,0.03);
       overflow-y: auto;
       overflow-x: hidden;
       margin-bottom: 15px;
       position: relative;
       transition: all 0.3s ease;
       width: calc(100% - 40px);
       max-width: 100%;
       margin-left: auto;
       margin-right: auto;
    }

    .message {
       margin: 15px 0;
       padding: 0;
       border-radius: 0;
       width: 80%;
       word-wrap: break-word;
       display: flex;
       align-items: flex-start;
       gap: 12px;
    }

    .message-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        flex-shrink: 0;
        box-shadow: none;
        border: none;
    }

    .message-content {
        padding: 10px 15px;
        border-radius: 12px;
        flex: 1;
        font-size: 14.5px;
        line-height: 1.6;
        letter-spacing: 0.2px;
        word-wrap: break-word;
        white-space: pre-wrap;
        width: calc(100% - 44px);
        box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }

    .user-message {
        margin-left: auto;
        margin-right: 10px;
        flex-direction: row-reverse;
    }

    .user-message .message-content {
        background-color: #5a5e68;
        color: #fff;
    }

    .bot-message {
        margin-right: auto;
        margin-left: 10px;
    }

    .bot-message .message-content {
        background-color: #e8e8e8;
        color: #333;
    }

    .welcome-message {
        display: flex;
        align-items: center;
		justify-content: center;
        gap: 10px;
        padding: 10px;
        background-color: #f2f2f2;
        border-radius: 8px;
        margin-bottom: 15px;
    }

    .welcome-message img {
		margin: 0px 10px;
        width: 24px;
        height: 24px;
    }

    .welcome-message span {
        font-size: 14.5px;
        font-weight: 400;
        letter-spacing: 0.2px;
        line-height: 1.6;
    }

    /* .panel {
        flex: calc(50% - 30px);
        border: none;
        padding: 25px;
        border-radius: 16px;
        background-color: #f8f9fd;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        transition: all 0.3s ease;
        display: flex;
        flex-direction: column;
        overflow: hidden;
    } */
    .input-panel {
        
        border: none;
        padding: 15px;
        border-radius: 16px;
        background-color: #f8f9fd;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        margin: 20px 0;
        /* width: 100%; */
    }

    

    .options-container {
        margin-top: 20px;
        padding: 20px;
        background-color: #f8f9fd;
        border: none;
        border-radius: 16px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    }

    .options-group {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 15px;
    }

    .option-item {
        flex: 1;
        min-width: 0;
        margin: 0;
    }

    .option-item label {
        display: block;
        margin-bottom: 5px;
        font-size: 13.5px;
        font-weight: 500;
        color: #555;
        letter-spacing: 0.2px;
    }

    .option-item select {
        width: 100%;
        padding: 10px;
        border: none;
        border-radius: 8px;
        background-color: white;
        box-shadow: inset 0 2px 10px rgba(0,0,0,0.03);
        font-size: 14px;
        font-weight: 400;
        letter-spacing: 0.2px;
        color: #2c3e50;
    }

    .slider-with-input {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .slider-with-input input[type="number"] {
        width: 60px;
        padding: 4px 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
        font-weight: 400;
        letter-spacing: 0.2px;
    }

    .slider-with-input .slider-container {
        flex: 1;
    }

    .slider-container input[type="range"] {
        width: 600px;
        margin: 0;
        height: 6px;
        background: #e0e0e0;
        border-radius: 3px;
        -webkit-appearance: none;
    }

    .slider-container input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 18px;
        height: 18px;
        background: white;
        border-radius: 50%;
        cursor: pointer;
    }

    #media {
        position: relative;
        width: 100%;
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    #media video {
		position: relative;
		width: 100%;
		height: auto;
        background: #f2f2f2;
        border-radius: 12px;
		overflow: hidden; /* 隐藏超出部分 */
    }

    .theme-toggle {
        position: absolute;
        top: 20px;
        right: 20px;
        z-index: 1000;
    }

    .theme-toggle button {
        background: none;
        border: none;
        cursor: pointer;
        padding: 8px;
        border-radius: 50%;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .theme-toggle button i {
        font-size: 20px;
    }

    /* 修改图标颜色 */
    .theme-toggle button i.fa-moon {
        color: #4568dc;
    }

    .theme-toggle button i.fa-sun {
        color: #ffd700;
    }

    /* 悬停效果 */
    .theme-toggle button:hover {
        background-color: rgba(0, 0, 0, 0.1);
        transform: scale(1.1);
    }

    /* 暗色主题样式 */
    body.dark-mode {
        background-color: #1a1a1a;
    }

    .dark-mode .outer-container {
        background: #2d2d2d;
        box-shadow: 0 8px 30px rgba(0,0,0,0.2);
    }

    .dark-mode .panel {
        background-color: #383838;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }

    .dark-mode .chat-container {
        background-color: #2d2d2d;
        box-shadow: inset 0 2px 10px rgba(0,0,0,0.2);
    }

    .dark-mode .message-content {
        color: #e0e0e0;
    }

    .dark-mode .user-message .message-content {
        background-color: #4568dc;
        color: #fff;
    }

    .dark-mode .bot-message .message-content {
        background-color: #454545;
        color: #fff;
    }

    .dark-mode .input-panel {
        background-color: #383838;
    }

    .dark-mode .input-panel textarea {
        background-color: #f2f2f2;
        color: #e0e0e0;
    }

    .dark-mode .options-container {
        background-color: #383838;
    }

    .dark-mode .option-item label {
        color: #e0e0e0;
    }

    .dark-mode .option-item select {
        background-color: #2d2d2d;
        color: #e0e0e0;
    }

    .dark-mode .welcome-message {
        background-color: #383838;
        color: #e0e0e0;
    }

    /* 在暗色主题样式部分添加滚动条样式 */
    .dark-mode .chat-container::-webkit-scrollbar {
        width: 8px;
    }

    .dark-mode .chat-container::-webkit-scrollbar-track {
        background: #2d2d2d;
        border-radius: 4px;
    }

    .dark-mode .chat-container::-webkit-scrollbar-thumb {
        background: #4a4a4a;
        border-radius: 4px;
    }

    .dark-mode .chat-container::-webkit-scrollbar-thumb:hover {
        background: #555555;
    }

    /* 同时也为日间模式添加美化的滚动条样式 */
    .chat-container::-webkit-scrollbar {
        width: 8px;
    }

    .chat-container::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 4px;
    }

    .chat-container::-webkit-scrollbar-thumb {
        background: #c1c1c1;
        border-radius: 4px;
    }

    .chat-container::-webkit-scrollbar-thumb:hover {
        background: #a8a8a8;
    }

    /* 在暗色主题样式部分添加以下代码 */
    .dark-mode .slider-with-input input[type="number"] {
        background-color: #2d2d2d;
        border: 1px solid #454545;
        color: #e0e0e0;
    }

    .dark-mode .slider-container input[type="range"] {
        background: #e6e6e6;
    }

    .dark-mode .slider-container input[type="range"]::-webkit-slider-thumb {
        background: #e6e6e6;
        box-shadow: 0 0 5px rgba(0,0,0,0.3);
    }

    /* 为滑块添加悬停效果 */
    .dark-mode .slider-container input[type="range"]::-webkit-slider-thumb:hover {
        transform: scale(1.1);
    }

    /* 为数字输入框添加焦点效果 */
    .dark-mode .slider-with-input input[type="number"]:focus {
        outline: none;
        border-color: #4568dc;
        box-shadow: 0 0 5px rgba(69, 104, 220, 0.3);
    }
	
	.dark-mode img[src$="voice.png"] {
	    filter: none; /* 移除滤镜，显示图标的原始颜色 */
	    opacity: 1; /* 确保图标不透明 */
	}
	
	.dark-mode #options-container.open{
		border-top: 1px solid #4b4b4b;
	}
	
	.dark-mode .form-inline{
		border-top: 1px solid #4b4b4b;
		background-color: #454545;
	}
	
	.dark-mode .form-inline .gap{
		background-color: #4b4b4b;
	}

	.dark-mode .container textarea{
		background-color: #454545;
	}
	
	.dark-mode .container textarea::placeholder{
		color: white
	}
	
	.dark-mode .Featureitem{
		background-color: #89898e;
	}
	
	.dark-mode .option-line{
		border-top: 1px solid #5e5e5e;
	}
	
	.dark-mode .option-line label{
		color: white;
	}
	
	.control-panel {
      display: none; /* 这将隐藏整个 control-panel div */
    }
	
	/*-------------------------------------------------------------修改部分------------------------------------------------------------*/
	
	/*上半部分整体布局*/
	.container {
	    display: flex;
	    padding: 0;
	    max-width: none;
	    margin: 0;
	    align-items: stretch;
	}
	
	.container form {
	    display: flex;
	    width: 100%;
	    gap: 8px;
	    align-items: flex-start;
	}
	
	.container textarea {
	    flex: 1;
	    border: none;
	    border-radius: 8px;
	    padding: 8px 12px;
	    background-color: #f2f2f2;
	    font-size: 14.5px;
	    letter-spacing: 0.2px;
	    font-weight: 500;
	    height: 30px;
	    max-height: 25px;
	    resize: none;
	    line-height: 1.5;
	    white-space: nowrap;
	    overflow-x: auto;
	    overflow-y: hidden;
		transition: all 1s;
	}
	
	.container button {
	    height: 35px;
	    border-radius: 8px;
	    border: none;
	    background: transparent;
	    color: white;
	    cursor: pointer;
	    transition: all 0.3s ease;
	    width: 30px;
	    display: flex;
	    align-items: center;
	    justify-content: center;
	    white-space: nowrap;
	}
	
	.container button:hover {
	    background: transparent;
	    transform: translateY(-1px);
	}
	
	/*板块布局*/
	.panel-left{
		flex: 50%;
		border: none;
		border-radius: 16px 0px 0px 16px;
		background-color: #f2f2f2;
		box-shadow: 0 4px 15px rgba(0,0,0,0.05);
		transition: all 0.3s ease;
		display: flex;
		flex-direction: column;
		overflow: hidden;
		position: relative;
	}
	
	.panel{
		flex: 50%;
		border: none;
		border-radius: 0px 16px 16px 0px;
		background-color: #f2f2f2;
		box-shadow: 0 4px 15px rgba(0,0,0,0.05);
		transition: all 0.3s ease;
		display: flex;
		flex-direction: column;
		overflow: hidden;
	}
	
	.panel-left:hover{
		transform: translateY(-2px);
		box-shadow: 0 6px 20px rgba(0,0,0,0.08);
	}
	
	.panel:hover {
	    transform: translateY(-2px);
	    box-shadow: 0 6px 20px rgba(0,0,0,0.08);
	}
	
	/*左侧内容布局*/
	.form-inline{
		display: flex;
		padding: 10px;
		flex-direction: row;
		align-items: center;
		justify-content: center;
		height: 50px;
		border-top: 1px solid #e1e1e1;
		position: relative;
		transition: all 1s;
	}
	
	.form-inline .gap{
		background-color: #e1e1e1;
		width: 1px;
		height: 40px;
	}
	
	.panel.image{
		display: flex;
		align-items: center;
		justify-content: center;
	}
	
	.panel .form-inline img{
		margin-left: 10px;
		margin-top: 10px;
		margin-right: 20px;
		width: 20px;
		height: 20px;
	}
	
	.submit{
		width: 50px;
		height: 50px;
	}
	
	.form-control {
	    max-width: 350px; /* 最大宽度 */
	}
	
	.more img {
	  width: 30px;
	  height: 30px;
	  transition: all 1s;
	}
	
	.input-panel{
		display: none;
	}
	
	/*左上表示栏*/
	.demo{
		position: absolute;
		left: 10px;
		top:10px;
		font-size: 30px;
		font-weight: 700;
		display: flex;
		align-items: center;
		justify-content: center;
		margin:0px 15px;
		z-index: 100;
	}
	
	.tips{
		margin-left: 5px;
		margin-top: 5px;
		text-align: center;
		width: 50px;
		font-size: 16px;
		font-weight: 500;
		color: #7e7e7e;
		background-color:white;
		border-radius: 50px;
	}
	
	#FeatureArea{
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		position: absolute;
		left: 30px;
		top:80px;
		z-index: 100;
		gap: 20px;
	}
	
	.Featureitem{
		border-radius: 50%;
		display: flex;
		height: 60px;
		width: 60px;
		align-items: center;
		justify-content: center;
		background-color: white;
		transition: all 0.6 ease;
	}
	
	#FeatureArea img {
	  height: 35px;
	  width: 35px;
	}
	
	#hand_item img{
		height: 40px;
		width: 40px;
	}
	
	.Featureitem:hover {
	  transform: scale(1.1); 
	  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); 
	}
	
	.Featureitem:active {
	  transform: scale(0.9); 
	  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4); /* 更深的阴影效果 */
	}
	
	/*右下标签栏*/
	.bottom-icon{
		display: flex;
		align-items: center;
		justify-content: center;
		font-size: 20px;
		font-weight: 600;
		position: absolute;
		left: 480px;
		top:1025px;
		z-index: 10;
	}
	
	.bottom-icon img{
		width: 30px;
		height: 30px;
	}
	
	
	/*选项卡组*/
	#options-container {
		transition: all 1s ease;
	    display: flex; /* 初始时隐藏 */
	    flex-direction: column; /* 垂直排列子元素 */
		align-items: center;
		justify-content: center;
		overflow: hidden;
		max-height: 0px;
	}
	
	#options-container.open{
		border-top: 1px solid #e6e6e6;
		
		max-height: 200px; /* 增加 max-height 的值，以适应内容和布局 */
	}
	
	.options-group {
		margin-top: 20px;
		overflow: hidden;
	    display: flex; /* 使用flex布局 */
	    align-items: center; /* 垂直居中对齐 */
		justify-content: center;
		gap: 20px;
	}
	
	.option-item{

		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		margin: 0px 10px;
		width: 100px;
	}
	
	.img_container img{
		height: 38px;
		width: 38px;
	}
	
	.img_container{
		overflow: hidden;
		display: flex;
		align-items: center;
		justify-content: center;
		height: 80px;
		width: 80px;
		background-color: #d9d9d9;
		border-radius: 12px;
		transition: all 0.3s; /* 平滑背景颜色变化 */
	}
	
	.img_container.selected {
	    background-color: white; /* 选中时的背景颜色 */
	}
	
	.option-line{
		transition: all 1s;
		border-top: 1px solid #e6e6e6;
		overflow: hidden;
		display: flex;
		flex-direction: row;
		align-items: center;
		justify-content: center;
		margin-top: 10px;
		width: 100%;
		height: 50px;
	}
	
	
	/*语音改变功能*/
	#voice-image {
	    transition: opacity 0.3s ease-in-out; /* 平滑过渡效果 */
	    display: block; /* 确保图片是块级元素 */
	}
	
	#voice-image.changing {
	    opacity: 0; /* 当图片正在变化时，透明度变为0 */
	}
	
	
	/* 轮播选择部分 */
	
	.swiper-container{
	  width: 500px;
	  height: auto;
	  padding:90px 0;
	  margin-left: auto;
	  margin-right: auto;
	  position: absolute;
	  top: 760px;
	  left: 50px;
	  visibility: hidden; /* 初始不可见 */
	  opacity: 0; /* 初始透明度 */
	  transition: all 1s ease; /* 定义过渡效果 */
	}
	
	#swiper2,#swiper3{
		top:780px
	}
	
	#swiper1 .swiper-slide {
	  text-align: center;
	  font-size: 18px;
	  background: #fff;
	  
	  width: 100px;
	  height: 120px;
	  border-radius: 12px;
	  overflow: hidden;
	  object-fit: cover;
	  
	  
	  /* Center slide text vertically */
	  display: -webkit-box;
	  display: -ms-flexbox;
	  display: -webkit-flex;
	  display: flex;
	  -webkit-box-pack: center;
	  -ms-flex-pack: center;
	  -webkit-justify-content: center;
	  justify-content: center;
	  -webkit-box-align: center;
	  -ms-flex-align: center;
	  -webkit-align-items: center;
	  align-items: center;
	  transition-property:all;
	}
	
	#swiper2 .swiper-slide, #swiper3 .swiper-slide{
	  text-align: center;
	  font-size: 18px;
	  background: #fff;
	  
	  width: 80px;
	  height: 80px;
	  border-radius: 50%;
	  overflow: hidden;
	  
	  /* Center slide text vertically */
	  display: -webkit-box;
	  display: -ms-flexbox;
	  display: -webkit-flex;
	  display: flex;
	  -webkit-box-pack: center;
	  -ms-flex-pack: center;
	  -webkit-justify-content: center;
	  justify-content: center;
	  -webkit-box-align: center;
	  -ms-flex-align: center;
	  -webkit-align-items: center;
	  align-items: center;
	  transition-property:all;
	}
	
	.#swiper1 img, #swiper3 img{
		width: 100%;
		height: 100%;
		object-fit: cover;
	}
	
	#swiper2 img{
		width: 40px;
		height: 40px;
	}
	
	.swiper-button-prev, .swiper-button-next {
	  opacity: 0; /* 初始透明度 */
	  transition: all 1s ease; /* 定义过渡效果 */
	  top: 910px;
	}
	
	.color_img{
		width: 100%;
		height: 100%;
		display: flex;
		align-items: center;
		justify-content: center;
	}

	
	.show{
		opacity: 1; /* 完全不透明 */
		visibility: visible; /* 可见 */
	}
	
	/*录音效果*/
	#stop_record{
		height: 30px;
		width: 30px;
		border-radius: 66px;
		background: linear-gradient(145deg, #f0f0f0, #cacaca);
		box-shadow:  5px 5px 26px #6e6e6e,
		             -5px -5px 26px #ffffff;
	}
	
	#recordGroup, #message {
	    transition: all 0.5s ease-in-out;
	}
	
	#recordGroup{
		position: absolute;
		display: flex;
		justify-content: center;
		flex-direction: row;
		left: 100px;
		top:8px;
	}
	
	.hidden {
	    opacity: 0;
	    visibility: hidden;
	}
	
	#record_wrapper,#stop_wrapper{
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		height: 50px;
		width: 50px;
		border-radius: 50%;
		background-color: #5865f2;
	}
	
	#record_wrapper img,#stop_wrapper img{
	  height: 25px; 
	  width: 25px; 
	  margin-right: 2px;
	  margin-left: 2px;
	  margin-bottom: 6px;
	  object-fit: cover; /* 保持图片的宽高比，可能会裁剪图片 */
	}
	
	#stop_wrapper{
		position: absolute;
		display: flex;
		justify-content: center;
		flex-direction: row;
		transition: all 0.5s ease-in-out;
		opacity: 0;
	}
	
	#recordLine{
		margin-top: 15px;
		height: 20px;
		width: 150px;
	}
	
	#activeLine{
		position: absolute;
		margin-top: 15px;
		height: 20px;
		width: 150px;
	}
	
	/*下方的maxlength部件*/
	.slider-container {
	  position: relative;
	}
	
	#chunk-size-input {
	  position: absolute;
	  top: 500px;
	  right: 65px;
	  z-index: 10;
	  border: none;
	  box-shadow: none;
	  font-size: 1em;
	  /* 其他样式根据您的设计调整 */
	}
	
	.slider-container {
	    margin-left: 10px; /* 为滑块容器添加左边距 */
	}
	
	/* 更多的CSS样式可以根据需要进行添加，以确保视觉效果符合设计要求。 */
	
    </style>
</head>
<body>

<div class="outer-container">
    <!-- <div class="main-title">
        <h1>2WAI Demo</h1>
        <div class="theme-toggle">
            <button id="theme-toggle-btn">
                <i class="fas fa-moon"></i>
            </button>
        </div>
    </div> -->

    <div class="container">

        <!-- z左侧视频面板 -->
        <div class="panel-left">
			
            <div class="control-panel">
                <div class="option">
                    <input id="use-stun" type="checkbox" checked/>
                    <label for="use-stun">Use STUN server</label>
                </div>
            </div>

			<!-- 视频展示区 -->
            <div id="media">
				<div class="demo">
					2WAI
					<div class="tips">
						Demo
					</div>
				</div>
				
				<div id="FeatureArea">
					<div class="Featureitem" id="change_item">
						<img src="./icon/change.png" alt="" />
					</div>
					<div class="Featureitem" id="clothes_item">
						<img src="./icon/clothes.png" alt="" />
					</div>
					<div class="Featureitem" id="hand_item">
						<img src="./icon/hand.png" alt="" />
					</div>
					<!-- <div class="Featureitem" id="like_item">
						<img src="./icon/like.png" alt="" />
					</div> -->
				</div>
				
                <audio id="audio" autoplay="true"></audio>
                <!-- <video id="video" autoplay="true" playsinline="true" src="base.mp4"></video> -->
				<video id="video" preload="auto" poster="./icon/loadingBackGorund.png" autoplay playsinline loop muted>
				  <source src="./video/base.mp4" type="video/mp4">
				  
				</video>
				
				<div class="bottom-icon">
					Zoom
					<img src="./icon/move.png" alt="" />
				</div>
				
				<!-- 自定义更换区 -->
				
				<div class="swiper-container" id='swiper1'>
				     <div class="swiper-wrapper">
					   <div class="swiper-slide">
					   	   <img src="https://waverlyc.xiaomy.net/img/back/6.png" alt="" />
					   </div>
				       <div class="swiper-slide">
						   <img src=https://waverlyc.xiaomy.net/img/back/1.png" alt="" />
					   </div>
				       <div class="swiper-slide">
						   <img src="https://waverlyc.xiaomy.net/img/back/2.png" alt="" />
					   </div>
				       <div class="swiper-slide">
						   <img src="https://waverlyc.xiaomy.net/img/back/3.png" alt="" />
					   </div>
				       <div class="swiper-slide">
						   <img src="https://waverlyc.xiaomy.net/img/back/4.png" alt="" />
					   </div>	 
					   <div class="swiper-slide">
					   		<img src="https://waverlyc.xiaomy.net/img/back/5.png" alt="" />
					   </div>	 
				     </div>
				</div> 
				<div class="swiper-button-prev swiper-button-white btn_1"></div>
				<div class="swiper-button-next swiper-button-white btn_1"></div>
				
				
				<div class="swiper-container" id='swiper2'>
				      <div class="swiper-wrapper">
				         <div class="swiper-slide">
				           <div class="color_img" style="background-color: #dc4b4b;">
				             <img src="./icon/voiceLine.png" alt="" />
				           </div>
				         </div>
				         <div class="swiper-slide">
				           <div class="color_img" style="background-color: #4bc05e;">
				             <img src="./icon/voiceLine.png" alt="" />
				           </div>
				         </div>
				         <div class="swiper-slide">
				           <div class="color_img" style="background-color: #4b66c0;">
				             <img src="./icon/voiceLine.png" alt="" />
				           </div>
				         </div>
				         <div class="swiper-slide">
				           <div class="color_img" style="background-color: #ffda48;">
				             <img src="./icon/voiceLine.png" alt="" />
				           </div>
				         </div>
				         <div class="swiper-slide">
				           <div class="color_img" style="background-color: #aa6de8;">
				             <img src="./icon/voiceLine.png" alt="" />
				           </div>
				         </div>     
				       </div>
				</div> 
				<div class="swiper-button-prev swiper-button-white btn_2" ></div>
				<div class="swiper-button-next swiper-button-white btn_2" ></div>
				
				<div class="swiper-container" id='swiper3'>
				      <div class="swiper-wrapper">
				         <div class="swiper-slide">
				           <img src="./icon/avatar1.png" alt="" />
				         </div>
				         <div class="swiper-slide">
				           <img src="./icon/avatar1.png" alt="" />
				         </div>
				         <div class="swiper-slide">
				           <img src="./icon/avatar1.png" alt="" />
				         </div>
				         <div class="swiper-slide">
				             <img src="./icon/avatar1.png" alt="" />
				         </div>
				         <div class="swiper-slide">
				           <img src="./icon/avatar1.png" alt="" />
				         </div>     
				       </div>
				</div> 
				<div class="swiper-button-prev swiper-button-white btn_3" ></div>
				<div class="swiper-button-next swiper-button-white btn_3" ></div>
				
				
				
				
            </div>

			
        </div>

        <!-- 右侧聊天面板 -->
        <div class="panel">
			
            <div class="chat-container" id="chat-messages">
                <div class="welcome-message">
                    <span>Welcome! You can cdivck the <img src="./icon/voice.png" alt="" class="voice_img"/> icon below or enter text to talk to me</span>
                </div>
                <!-- 聊天消息将在这里动态添加 -->
            </div>
			
			<form class="form-inline" id="echo-form">
				
				<div id="image-container">
				    <img id="voice-image" class="voice_img" src="./icon/voice.png" alt="voice" onclick="changeImage()  />
				</div>
				
				<div class="gap"></div> 
				
			    <textarea class="form-control" id="message" placeholder="Type your message here..."></textarea>
				
				<div id="recordGroup" class="hidden">
				    <div id="record_wrapper">
				        <img id="recording" src="./icon/recording.png" alt="microphone" />
				    </div>
				    <div id="stop_wrapper">
				        <div id="stop_record"></div>
				    </div>
				    <img id="recordLine" src="./icon/recordLine.png" alt="Line" />
					<img id="activeLine" src="./icon/vioce_active.gif" alt="动画演示">
				</div>


				<!-- <div>
				    <label for="btn-record"></label>
				    <button class="btn btn-primary" id="btn_start_record">Start Recording</button>
				    <button class="btn btn-primary" id="btn_stop_record" disabled>Stop Recording</button>
				</div> -->
				
				<!-- 按钮包裹的提交 -->
			   <button type="submit" class="btn btn-default" onclick="start()">
				   <img class="submit" src="./icon/submit.png" alt="submit" />
			   </button>
			   <div class="gap"></div>		<!-- 间隔竖线 -->
			   
			   <div class="more" id="moreButton">
				   <img id="more_img" src="./icon/more.png" alt="" />
			   </div>
			   
			</form>
			
			<!-- 隐藏式选择框 -->
			<div id="options-container">
			     <div class="options-group">
			         <div class="option-item">
						 <div class="img_container" id="avatar-name">
							 <img i src="./icon/Digital Human.png" alt="" />
						 </div>
			             <label for="avatar-name">Digital Human</label>
			         </div>
			     
			         <div class="option-item">
						 <div class="img_container" id="tts-selection"> 
						 	<img src="./icon/cude.png" alt="" />
						 </div>
						 
			             <label for="tts-selection">TTS Selection</label>
			         </div>
			     
			         <div class="option-item">
						 <div class="img_container" id="avatar-voice">
						 	<img  src="./icon/voiceLine.png" alt="" />
						 </div>
			             <label for="avatar-voice">TTS Sound</label>
			         </div>
					 
					 <div class="option-item">
					 	 <div class="img_container" id="avatar-background">
					 	 	<img src="./icon/background.png" alt="" />
					 	 </div>
					     <label for="avatar-background">Background</label>
					 </div>
					 
			     </div>
				 
				 <!-- 拖拉调节条 -->
				 <div class="option-line">
					<label for="chunk-size">Min Length</label>
					<div class="slider-with-input">
					    <input type="number" id="chunk-size-input" class="form-control" min="0" max="30" value="10" style="display: none;"> 
					    <div class="slider-container">
					        <input type="range" id="chunk-size" class="form-control" min="0" max="30" step="1" value="10">
					    </div>
					</div>
				 </div>
				 
			 </div>
			
        </div>
		
		
    </div>

    <div class="input-panel">
        <button type="button" id="start" onclick="start()">Start</button>
        <button type="button" id="stop" style="display: none" onclick="stop()">Stop</button>
        <input type="hidden" id="sessionid" value="0">
    </div>

</div>


</body>



<script src="client_wn.js"></script>
<!-- <script type="text/javascript" src="http://cdn.sockjs.org/sockjs-0.3.4.js"></script> -->
<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<script src="swiper.min.js"></script>

<script>
	/*max滑块的更改*/
	document.addEventListener('DOMContentLoaded', function() {
	  var slider = document.getElementById('chunk-size');
	  var inputNumber = document.getElementById('chunk-size-input');
	
	  // 监听滑块的变化
	  slider.addEventListener('input', function() {
	    // 更新输入框的值
	    inputNumber.value = slider.value;
	
	    // 计算滑块的位置
	    var sliderRect = slider.getBoundingClientRect();
	    var inputNumberHeight = inputNumber.offsetHeight;
	
	    // 设置输入框的位置，使其位于滑块的中心
	    inputNumber.style.top = `${sliderRect.top + (sliderRect.height - inputNumberHeight) / 2}px`;
	    inputNumber.style.left = `${sliderRect.left + sliderRect.width}px`;
	  });
	});
</script>

<script>
	//DDsheng修改的	
	
	
	
	// 外部监听器，用于在视频播放结束后更换视频源
	var videoElement = document.getElementById('video');
	videoElement.addEventListener('ended', function() {
	    // 检查当前视频源是否为like.mp4
	    if (videoElement.src.endsWith('like.mp4')) {
	        // 视频播放结束后更换视频源为hand.mp4
	        videoElement.src = './video/hand.mp4';
	        videoElement.play(); // 播放hand.mp4
	    } else if (videoElement.src.endsWith('hand.mp4')) {
	        // 视频播放结束后更换视频源为base.mp4并设置循环播放
	        videoElement.src = './video/base.mp4';
	        videoElement.loop = true; 
	        videoElement.play(); // 播放base.mp4
	    }
	});
	
	// 为hand_item添加点击事件
	document.getElementById('hand_item').addEventListener('click', function() {
	    var video = document.getElementById('video');
	    
	    // 首先播放like.mp4
	    video.src = './video/like.mp4';
	    video.loop = false; // 取消循环播放
	    video.play(); // 开始播放视频
	});
	
	
	/*---------------为单个板块添加监听器---------------------*/
	document.addEventListener('DOMContentLoaded', function() {
	    var avatarBackground = document.getElementById('avatar-background');
	    var avatarVoice = document.getElementById('avatar-voice');
	    var avatarName = document.getElementById('avatar-name'); // 获取 'avatar-name' 元素
	    var swiperBox1 = document.getElementById('swiper1');
	    var swiperBox2 = document.getElementById('swiper2');
	    var swiperBox3 = document.getElementById('swiper3'); // 获取 'swiper3' 容器
	    var prevButton = document.querySelector('.swiper-button-prev');
	    var nextButton = document.querySelector('.swiper-button-next');
	
	    // 为 'avatar-background' 添加点击事件监听器
	    avatarBackground.addEventListener('click', function() {
	        // 隐藏所有swiper
	        [swiperBox1, swiperBox2, swiperBox3].forEach(function(swiper) {
	            swiper.classList.remove('show');
	        });
	        prevButton.classList.remove('show');
	        nextButton.classList.remove('show');
	
	        // 显示swiper1
	        swiperBox1.classList.add('show');
	        prevButton.classList.add('show');
	        nextButton.classList.add('show');
	    });
	
	    // 为 'avatar-voice' 添加点击事件监听器
	    avatarVoice.addEventListener('click', function() {
	        // 隐藏所有swiper
	        [swiperBox1, swiperBox2, swiperBox3].forEach(function(swiper) {
	            swiper.classList.remove('show');
	        });
	        prevButton.classList.remove('show');
	        nextButton.classList.remove('show');
	
	        // 显示swiper2
	        swiperBox2.classList.add('show');
	        prevButton.classList.add('show');
	        nextButton.classList.add('show');
	    });
	
	    // 为 'avatar-name' 添加点击事件监听器
	    avatarName.addEventListener('click', function() {
	        // 隐藏所有swiper
	        [swiperBox1, swiperBox2, swiperBox3].forEach(function(swiper) {
	            swiper.classList.remove('show');
	        });
	        prevButton.classList.remove('show');
	        nextButton.classList.remove('show');
	
	        // 显示swiper3
	        swiperBox3.classList.add('show');
	        prevButton.classList.add('show');
	        nextButton.classList.add('show');
	    });
	});
	
	
	/*小按钮旋转*/


	/*-------------------------------------隐藏框的展示-------------------------------------*/
	$('.more').click(function() {
			
		// 获取轮播区域元素
		  var buttons1 = document.querySelectorAll('.btn_1');
		  var swiperBox1 = document.getElementById('swiper1');
		
		  var buttons2 = document.querySelectorAll('.btn_2');
		  var swiperBox2 = document.getElementById('swiper2');
		  
		  var buttons3 = document.querySelectorAll('.btn_3');
		  var swiperBox3 = document.getElementById('swiper3');
		  
		 function hideSwiperAndButtons(swiperBox, buttons) {
		    // 如果轮播区域显示，则隐藏轮播区域和所有按钮
		    if (swiperBox.classList.contains('show')) {
		      swiperBox.classList.remove('show');
		      buttons.forEach(function(button) {
		        button.classList.remove('show');
		      });
		    }
		  }
		  
		// 隐藏swiper1和对应的按钮
		hideSwiperAndButtons(swiperBox1, buttons1);
		// 隐藏swiper2和对应的按钮
		hideSwiperAndButtons(swiperBox2, buttons2);
		//
		hideSwiperAndButtons(swiperBox3, buttons3);
		
		var optionscontainer = document.getElementById('options-container');
		if(optionscontainer.classList.contains('open')){
			optionscontainer.classList.remove('open');
		}else{
			optionscontainer.classList.add('open');
		}
		
		 // 检查more_img的src是否已经更换为line.png
		        if ($('#more_img').attr('src') === './icon/line.png') {
		            // 如果是line.png，则切换回more.png
		            $('#more_img').attr('src', './icon/more.png');
		        } else {
		            // 否则，切换到line.png
		            $('#more_img').attr('src', './icon/line.png');
		        }
		
	    // $('#options-container').toggle(); // 使用 jQuery 的 toggle 方法来切换显示和隐藏
	});
	
	
	
	
	/*功能元素选中*/
	$(document).ready(function() {
	    // 功能元素选中
	    $('.option-item').click(function() {
			
			/*整体获取和删除*/
	        var imgContainer = $(this).find('.img_container');
			
			var swiperBox = document.querySelector('.swiper-container');
			var prevButton = document.querySelector('.swiper-button-prev');
			var nextButton = document.querySelector('.swiper-button-next');
			
			
	        if (imgContainer.hasClass('selected')) {
	            imgContainer.removeClass('selected');
				swiperBox.classList.remove('show');
				prevButton.classList.remove('show');
				nextButton.classList.remove('show');
	        } else {
	            $('.img_container').removeClass('selected');
	            imgContainer.addClass('selected');
	        }
			
	    });

	    // 点击文档其他区域时重置所有 .img_container 的选中状态
	    $(document).click(function(event) {
			// 获取所有btn_1和btn_2类的按钮
			  var buttons1 = document.querySelectorAll('.btn_1');
			  var buttons2 = document.querySelectorAll('.btn_2');
			  var buttons3 = document.querySelectorAll('.btn_3');
			
			  // 获取swiper1和swiper2的容器
			  var swiperBox1 = document.getElementById('swiper1');
			  var swiperBox2 = document.getElementById('swiper2');
			  var swiperBox3 = document.getElementById('swiper3');
	       
			 // 检查点击的目标是否在swiper1或swiper2的按钮或容器内
			  var isInsideSwiper1 = Array.from(buttons1).some(function(button) { return button.contains(event.target); }) ||
			                       swiperBox1.contains(event.target);
			  var isInsideSwiper2 = Array.from(buttons2).some(function(button) { return button.contains(event.target); }) ||
			                       swiperBox2.contains(event.target);
			  var isInsideSwiper3 = Array.from(buttons3).some(function(button) { return button.contains(event.target); }) ||
			                     swiperBox3.contains(event.target);
			
			  // 如果点击的目标不在swiper1和swiper2的按钮或容器内
			  if (!isInsideSwiper3&&!isInsideSwiper1 && !isInsideSwiper2 && !$(event.target).closest('.option-item').length) {
			    // 移除所有.img_container的selected类
			    document.querySelectorAll('.img_container').forEach(function(container) {
			      container.classList.remove('selected');
			    });
			    // 移除swiper1和swiper2的show类
			    swiperBox1.classList.remove('show');
			    swiperBox2.classList.remove('show');
				swiperBox3.classList.remove('show');
			    // 移除所有.btn_1和.btn_2按钮的show类
			    Array.from(buttons1).forEach(function(button) {
			      button.classList.remove('show');
			    });
			    Array.from(buttons2).forEach(function(button) {
			      button.classList.remove('show');
			    });
				Array.from(buttons3).forEach(function(button) {
				  button.classList.remove('show');
				});
			  }
	    });
		
	});

	
	/*声音切换*/
	var voiceFlag = true; 
	
	function changeImage() {
		console.log("yes");
		
	    // 获取图片元素
	    var image = document.getElementById('voice-image');
		
		voiceFlag=!voiceFlag;
	    var newSrc =voiceFlag? './icon/voice.png' : './icon/left.png'; // 根据 voiceFlag 的值选择图片
	
	    // 添加过渡效果
	    image.classList.add('changing');
	
	    // 移除过渡效果类，这将在 CSS 中触发过渡
	    setTimeout(function() {
			// 设置图片新源
			image.src = newSrc;
	        image.classList.remove('changing');
	    }, 300); // 300毫秒后移除，与 CSS 中的过渡时间相匹配
		
		var message = document.getElementById('message');
		var recordGroup = document.getElementById('recordGroup');
		var voiceImage = document.getElementById('voice-image');
	
		// 切换显示状态
		if (message.classList.contains('hidden')) {
		    message.classList.remove('hidden');
		    recordGroup.classList.add('hidden');
		} else {
		    message.classList.add('hidden');
		    recordGroup.classList.remove('hidden');
		}
		
		var recordWrapper = document.getElementById('record_wrapper');
		var stopWrapper = document.getElementById('stop_wrapper');
		var activeLine = document.getElementById('activeLine');
			
		recordWrapper.addEventListener('click', function() {
		    // 切换 record_wrapper 和 stop_wrapper 的显示状态
		    if (recordWrapper.classList.contains('show')) {
		        recordWrapper.classList.remove('show');
		        stopWrapper.classList.add('show');
		        activeLine.classList.add('show');
		    } else {
		        recordWrapper.classList.add('show');
		        stopWrapper.classList.remove('show');
		        activeLine.classList.remove('show');
		    }
		});
		
	}
	
	document.addEventListener('DOMContentLoaded', function() {
	    var voiceImage = document.getElementById('voice-image');
	    voiceImage.addEventListener('click', changeImage);
	});
	
</script>

<!-- 为了分别获取元素这里设置3个js来单独控制 -->
<script>
// 背景选择部分
	effect = 1
	  var swiper1 = new Swiper('#swiper1', {
	  loop: true,
	  speed: 1500,
	  slidesPerView: 5,
	  spaceBetween: 30,
	  centeredSlides : true,
	  watchSlidesProgress : true,
	  on: {
	    setTranslate: function(){
			slides = this.slides
			for(i=0; i< slides.length; i++){
				slide = slides.eq(i)
				progress = slides[i].progress
				//slide.html(progress.toFixed(2)); 看清楚progress是怎么变化的
				    slide.css({'opacity': '','background': ''});slide.transform('');//清除样式
					
					if(effect == 1){
					    slide.transform('scale('+(1 - Math.abs(progress)/8)+')');  
					}else if(effect == 2){
						slide.css('opacity',(1-Math.abs(progress)/6));
					    slide.transform('translate3d(0,'+ Math.abs(progress)*20+'px, 0)');  
					}
					else if(effect == 3){
					    slide.transform('rotate('+ progress*30+'deg)');  
					}else if(effect == 4){
						slide.css('background','rgba('+ (255 - Math.abs(progress)*20) +','+ (127 + progress*32) +',' + Math.abs(progress)*64 + ')');
					}
					
				}	
		},
		setTransition: function(transition) {
			for (var i = 0; i < this.slides.length; i++) {
				var slide = this.slides.eq(i)
				slide.transition(transition);
			}
		},
		slideChangeTransitionEnd: function () {
		    // 获取当前激活的slide的索引
		    var activeIndex = this.activeIndex;
	
		    // 获取当前激活的slide元素
		    var activeSlide = this.slides[activeIndex];
	
		    // 获取当前激活的slide中的图片元素
		    var activeImage = activeSlide.querySelector('img');
	
		    // 打印图片的src属性
		    console.log(activeImage.src);
		}
	  },
	  navigation: {
		nextEl: '.swiper-button-next',
		prevEl: '.swiper-button-prev',
	  },
	     pagination: {
	       el: '.swiper-pagination',
	       clickable: true,
	     },
	   });
</script>

<!-- 轮播图2 -->
<script>
// 声音选择部分
	effect = 1
	  var swiper2 = new Swiper('#swiper2', {
	  loop: true,
	  speed: 1500,
	  slidesPerView: 5,
	  spaceBetween: 30,
	  centeredSlides : true,
	  watchSlidesProgress : true,
	  on: {
	    setTranslate: function(){
			slides = this.slides
			for(i=0; i< slides.length; i++){
				slide = slides.eq(i)
				progress = slides[i].progress
				//slide.html(progress.toFixed(2)); 看清楚progress是怎么变化的
				    slide.css({'opacity': '','background': ''});slide.transform('');//清除样式
					
					if(effect == 1){
					    slide.transform('scale('+(1 - Math.abs(progress)/8)+')');  
					}else if(effect == 2){
						slide.css('opacity',(1-Math.abs(progress)/6));
					    slide.transform('translate3d(0,'+ Math.abs(progress)*20+'px, 0)');  
					}
					else if(effect == 3){
					    slide.transform('rotate('+ progress*30+'deg)');  
					}else if(effect == 4){
						slide.css('background','rgba('+ (255 - Math.abs(progress)*20) +','+ (127 + progress*32) +',' + Math.abs(progress)*64 + ')');
					}
					
				}	
		},
		setTransition: function(transition) {
			for (var i = 0; i < this.slides.length; i++) {
				var slide = this.slides.eq(i)
				slide.transition(transition);
			}
		},
	  },
	  navigation: {
		nextEl: '.swiper-button-next',
		prevEl: '.swiper-button-prev',
	  },
	     pagination: {
	       el: '.swiper-pagination',
	       clickable: true,
	     },
	   });
	   
</script>

<!-- 轮播图3 -->
<script>
// 人物选择部分
	effect = 1
	  var swiper3 = new Swiper('#swiper3', {
	  loop: true,
	  speed: 1500,
	  slidesPerView: 5,
	  spaceBetween: 30,
	  centeredSlides : true,
	  watchSlidesProgress : true,
	  on: {
	    setTranslate: function(){
			slides = this.slides
			for(i=0; i< slides.length; i++){
				slide = slides.eq(i)
				progress = slides[i].progress
				//slide.html(progress.toFixed(2)); 看清楚progress是怎么变化的
				    slide.css({'opacity': '','background': ''});slide.transform('');//清除样式
					
					if(effect == 1){
					    slide.transform('scale('+(1 - Math.abs(progress)/8)+')');  
					}else if(effect == 2){
						slide.css('opacity',(1-Math.abs(progress)/6));
					    slide.transform('translate3d(0,'+ Math.abs(progress)*20+'px, 0)');  
					}
					else if(effect == 3){
					    slide.transform('rotate('+ progress*30+'deg)');  
					}else if(effect == 4){
						slide.css('background','rgba('+ (255 - Math.abs(progress)*20) +','+ (127 + progress*32) +',' + Math.abs(progress)*64 + ')');
					}
					
				}	
		},
		setTransition: function(transition) {
			for (var i = 0; i < this.slides.length; i++) {
				var slide = this.slides.eq(i)
				slide.transition(transition);
			}
		},
	  },
	  navigation: {
		nextEl: '.swiper-button-next',
		prevEl: '.swiper-button-prev',
	  },
	     pagination: {
	       el: '.swiper-pagination',
	       clickable: true,
	     },
	   });
	   
</script>
       

<script type="text/javascript" charset="utf-8">
	
	
	
	$(document).ready(function() {
	  // var host = window.location.hostname
	  // var ws = new WebSocket("ws://"+host+":8000/humanecho");
	  // //document.getElementsByTagName("video")[0].setAttribute("src", aa["video"]);
	  // ws.onopen = function() {
		// console.log('Connected');
	  // };
	  // ws.onmessage = function(e) {
		// console.log('Received: ' + e.data);
		// data = e
		// var vid = JSON.parse(data.data); 
		// console.log(typeof(vid),vid)
		// //document.getElementsByTagName("video")[0].setAttribute("src", vid["video"]);
		
	  // };
	  // ws.onclose = function(e) {
		// console.log('Closed');
	  // };
	  
	

	  function addMessage(message, isUser) {
        const messageDiv = $('<div>')
            .addClass('message')
            .addClass(isUser ? 'user-message' : 'bot-message');
        
        const avatar = $('<img>')
            .addClass('message-avatar')
            .attr('src', './icon/icon.png')
            .attr('alt', isUser ? 'User' : 'Bot');
        
        const content = $('<div>')
            .addClass('message-content')
            .text(message);
        
        messageDiv.append(avatar).append(content);
        $('#chat-messages').append(messageDiv);
        $('#chat-messages').scrollTop($('#chat-messages')[0].scrollHeight);
    }

	  $('#echo-form').on('submit', function(e) {
      e.preventDefault();
      var message = $('#message').val();
      // 添加用户消息到聊天框
      addMessage(message, true);
      
      console.log('Sending: ' + message);
      console.log('sessionid: ',document.getElementById('sessionid').value);
      fetch('/human', {
            body: JSON.stringify({
                text: message,
                type: 'chat',
                interrupt: true,
                sessionid:parseInt(document.getElementById('sessionid').value),
                avatarName:document.getElementById('avatar-name').value,
                ttsSelection:document.getElementById('tts-selection').value,
                avatarVoice:document.getElementById('avatar-voice').value,
                chunkSize:document.getElementById('chunk-size').value
            }),
            headers: {
                'Content-Type': 'application/json'
            },
            method: 'POST'
      })
      .then(response => response.json())
      .then(data => {
          // 添加机器人的回复消息
          const llmResponse = data.res || "No valid response was returned！";
          addMessage(llmResponse, false);
      })
      .catch(error => {
          console.error('Error:', error);
          // 可选：显示错误消息
          addMessage("Sorry, an error occurred. Please try again later.", false);
      });
      
      // 清空入框并将焦点重新放在输入框上
      $('#message').val('');
	  });

    $('#btn_start_record').click(function() {
        // 开始录制
        console.log('Starting recording...');
        fetch('/record', {
            body: JSON.stringify({
                    type: 'start_record',
                }),
                headers: {
                    'Content-Type': 'application/json'
                },
            method: 'POST'
        }).then(function(response) {
            if (response.ok) {
                console.log('Recording started.');
                $('#btn_start_record').prop('disabled', true);
                $('#btn_stop_record').prop('disabled', false);
                // $('#btn_download').prop('disabled', true);
            } else {
                console.error('Failed to start recording.');
            }
        }).catch(function(error) {
            console.error('Error:', error);
        });
    });

    $('#btn_stop_record').click(function() {
        // 结束录制
        console.log('Stopping recording...');
        fetch('/record', {
            body: JSON.stringify({
                    type: 'end_record',
                }),
                headers: {
                    'Content-Type': 'application/json'
                },
            method: 'POST'
        }).then(function(response) {
            if (response.ok) {
                console.log('Recording stopped.');
                $('#btn_start_record').prop('disabled', false);
                $('#btn_stop_record').prop('disabled', true);
                // $('#btn_download').prop('disabled', false);
            } else {
                console.error('Failed to stop recording.');
            }
        }).catch(function(error) {
            console.error('Error:', error);
        });
    });

    // $('#btn_download').click(function() {
    //     // 载视频文件
    //     console.log('Downloading video...');
    //     fetch('/record_lasted.mp4', {
    //         method: 'GET'
    //     }).then(function(response) {
    //         if (response.ok) {
    //             return response.blob();
    //         } else {
    //             throw new Error('Failed to download the video.');
    //         }
    //     }).then(function(blob) {
    //         // 创建一个 Blob 对象
    //         const url = window.URL.createObjectURL(blob);
    //         // 创建一个藏的可下载链接
    //         const a = document.createElement('a');
    //         a.style.display = 'none';
    //         a.href = url;
    //         a.download = 'record_lasted.mp4';
    //         document.body.appendChild(a);
    //         // 触发下载
    //         a.click();
    //         // 清理
    //         window.URL.revokeObjectURL(url);
    //         document.body.removeChild(a);
    //         console.log('Video downloaded successfully.');
    //     }).catch(function(error) {
    //         console.error('Error:', error);
    //     });
    // });

	});
</script>

<script>
    // 在现有的 JavaScript 代码中添加
    async function loadOptions() {
        const response = await fetch('options.json');
        const options = await response.json();
        window.appConfig = options;

        // 填充 Digital Human 选项框
        const avatarSelect = document.getElementById('avatar-name');
        options.avatars.forEach(avatar => {
            const option = document.createElement('option');
            option.value = avatar.value;
            option.textContent = avatar.label;
            avatarSelect.appendChild(option);
        });

        // 填充 TTS Selection 选择框
        const ttsSelect = document.getElementById('tts-selection');
        options.ttsModules.forEach(tts => {
            const option = document.createElement('option');
            option.value = tts.value;
            option.textContent = tts.label;
            ttsSelect.appendChild(option);
        });

        // 填充 TTS Sound 选择框
        const voiceSelect = document.getElementById('avatar-voice');
        options.ttsVoices.forEach(voice => {
            const option = document.createElement('option');
            option.value = voice.value;
            option.textContent = voice.label;
            voiceSelect.appendChild(option);
        });

        // 设置默认选中项
        if (options.avatars.length > 0) {
            avatarSelect.value = options.avatars[0].value;
        }
        if (options.ttsModules.length > 0) {
            ttsSelect.value = options.ttsModules[0].value;
        }
        if (options.ttsVoices.length > 0) {
            voiceSelect.value = options.ttsVoices[0].value;
        }
    }

    // Initialize options
    loadOptions();

    // 同步滑块和输入框的值
    const chunkSizeSlider = document.getElementById('chunk-size');
    const chunkSizeInput = document.getElementById('chunk-size-input');

    chunkSizeSlider.addEventListener('input', function(e) {
        chunkSizeInput.value = e.target.value;
    });

    chunkSizeInput.addEventListener('input', function(e) {
        let value = parseInt(e.target.value);
        if (value < 0) value = 0;
        if (value > 30) value = 30;
        if (!isNaN(value)) {
            chunkSizeSlider.value = value;
        }
    });
</script>
<!-- <script type="text/javascript">
    window.addEventListener('load', () => {
      // 确保页面加载完毕后执行
      const startButton = document.getElementById('start');
      if (startButton) {
        startButton.click(); // 触发点击事件
      }
    });
</script> -->

<!-- ----------------------------切换黑暗模式------------------------------ -->
<script>
    const changeItem = document.getElementById('change_item');
    const themeIcon = changeItem.querySelector('i');
	var flag=false;
	
    // 检查本地存储中的主题设置
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'dark') {
		flag=true;
        document.body.classList.add('dark-mode');
        themeIcon.classList.replace('fa-moon', 'fa-sun');
    }
	
    changeItem.addEventListener('click', () => {
        document.body.classList.toggle('dark-mode');
		flag=!flag;
		changeImagedark()
        if (document.body.classList.contains('dark-mode')) {
            themeIcon.classList.replace('fa-moon', 'fa-sun');
            localStorage.setItem('theme', 'dark');
        } else {
            themeIcon.classList.replace('fa-sun', 'fa-moon');
            localStorage.setItem('theme', 'light');
        }
    });
	

	function changeImagedark() {
	    // 获取所有类名为 'voice_img' 的 img 元素
	    const images = document.querySelectorAll('.voice_img');
	  
	    // 遍历这些 img 元素
	    images.forEach(image => {
	        // 检查每个 img 的 src 是否以 './icon/voice.png' 结尾
	        if (image.src.endsWith('/voice.png')&&flag) {
	            // 替换 src 为 './icon/voice_dark.png'
	            image.src = image.src.replace('/voice.png', '/voice_dark.png');
	        }
			if(image.src.endsWith('/voice_dark.png')&&!flag){
				image.src = image.src.replace('/voice_dark.png', '/voice.png');
			}
	    });
	}
	
</script>
<script>
    // 添加视频高度监听和聊天容器高度整功能
    function adjustChatContainerHeight() {
        const video = document.querySelector('#video');
        const chatContainer = document.querySelector('.chat-container');
        const form = document.querySelector('#echo-form'); // 确保你的表单有一个ID
    
        if (video && chatContainer && form) {
            const videoHeight = video.offsetHeight;
            const formHeight = form.offsetHeight;
            const adjustedHeight = videoHeight - formHeight-50px;
    
            if (adjustedHeight > 0) {
                chatContainer.style.height = `${adjustedHeight}px`;
                chatContainer.style.minHeight = `${adjustedHeight}px`;
                chatContainer.style.maxHeight = `${videoHeight}px`; // 你可以根据需要调整最大高度
            } else {
                // 如果计算出的高度小于或等于0，你可以设置一个最小高度或者直接使用视频的高度
                chatContainer.style.height = `${videoHeight}px`;
                chatContainer.style.minHeight = `${videoHeight}px`;
                chatContainer.style.maxHeight = `${videoHeight}px`;
            }
        }
    }
    
    // 监听视频加载事件
    document.querySelector('#video').addEventListener('loadedmetadata', () => {
        setTimeout(adjustChatContainerHeight, 100); // 迟一点执行以确保视频尺寸已更新
    });
    
    // 创建 ResizeObserver 来监听视频尺寸变化
    const resizeObserver = new ResizeObserver(entries => {
        adjustChatContainerHeight();
    });
    
    // 开始观察视频元素
    resizeObserver.observe(document.querySelector('#video'));
    
    // 监听窗口大小变化
    window.addEventListener('resize', adjustChatContainerHeight);
    
    // 定期检查视频高度（以防其他情况导致的变化）
    setInterval(adjustChatContainerHeight, 1000);
</script>
</html>
