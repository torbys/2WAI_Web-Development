<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>2WAI Demo</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
    /* 添加在style标签最前面，设置全局字体 */
    * {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    .outer-container {
        max-width: 1200px;
        margin: 30px auto;
        background: #ffffff;
        border-radius: 20px;
        box-shadow: 0 8px 30px rgba(0,0,0,0.08);
        padding: 25px;
        border: none;
    }

    .main-title {
        margin: -25px -25px 30px -25px;
        border-radius: 20px 20px 0 0;
        text-align: center;
        padding: 25px;
        background: linear-gradient(135deg, #4568dc, #b06ab3);
        color: white;
    }

    .main-title h1 {
        margin: 0;
        font-size: 28px;
        font-weight: 600;
        letter-spacing: 0.5px;
        font-family: "SF Pro Display", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }

    .control-panel {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
        flex-wrap: wrap;
    }

    .btn {
        padding: 10px 20px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        font-size: 14px;
    }

    .btn-primary {
        background: linear-gradient(135deg, #4568dc, #b06ab3);
        color: white;
    }

    .btn-primary:hover {
        background: linear-gradient(135deg, #3f5bd3, #a055a8);
        transform: translateY(-1px);
    }

    .btn-secondary {
        background-color: #2196F3;
        color: white;
    }

    .btn-secondary:hover {
        background-color: #1e88e5;
    }

    .chat-container {
	   flex: 1;
       min-height: 0;
       max-height: none;
       border: none;
       border-radius: 12px;
       background-color: #f2f2f2;
       padding: 20px;
       box-shadow: inset 0 2px 10px rgba(0,0,0,0.03);
       overflow-y: auto;
       overflow-x: hidden;
       margin-bottom: 15px;
       position: relative;
       transition: height 0.3s ease;
       width: calc(100% - 40px);
       max-width: 100%;
       margin-left: auto;
       margin-right: auto;
    }

    .message {
       margin: 15px 0;
       padding: 0;
       border-radius: 0;
       width: 80%;
       word-wrap: break-word;
       display: flex;
       align-items: flex-start;
       gap: 12px;
    }

    .message-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        flex-shrink: 0;
        box-shadow: none;
        border: none;
    }

    .message-content {
        padding: 10px 15px;
        border-radius: 12px;
        flex: 1;
        font-size: 14.5px;
        line-height: 1.6;
        letter-spacing: 0.2px;
        word-wrap: break-word;
        white-space: pre-wrap;
        width: calc(100% - 44px);
        box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }

    .user-message {
        margin-left: auto;
        margin-right: 10px;
        flex-direction: row-reverse;
    }

    .user-message .message-content {
        background-color: #5a5e68;
        color: #fff;
    }

    .bot-message {
        margin-right: auto;
        margin-left: 10px;
    }

    .bot-message .message-content {
        background-color: #e8e8e8;
        color: #333;
    }

    .welcome-message {
        display: flex;
        align-items: center;
		justify-content: center;
        gap: 10px;
        padding: 10px;
        background-color: #f2f2f2;
        border-radius: 8px;
        margin-bottom: 15px;
    }

    .welcome-message img {
		margin: 0px 10px;
        width: 24px;
        height: 24px;
    }

    .welcome-message span {
        font-size: 14.5px;
        font-weight: 400;
        letter-spacing: 0.2px;
        line-height: 1.6;
    }

    /* .panel {
        flex: calc(50% - 30px);
        border: none;
        padding: 25px;
        border-radius: 16px;
        background-color: #f8f9fd;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        transition: all 0.3s ease;
        display: flex;
        flex-direction: column;
        overflow: hidden;
    } */
    .input-panel {
        
        border: none;
        padding: 15px;
        border-radius: 16px;
        background-color: #f8f9fd;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        margin: 20px 0;
        /* width: 100%; */
    }

    

    .options-container {
        margin-top: 20px;
        padding: 20px;
        background-color: #f8f9fd;
        border: none;
        border-radius: 16px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    }

    .options-group {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 15px;
    }

    .option-item {
        flex: 1;
        min-width: 0;
        margin: 0;
    }

    .option-item label {
        display: block;
        margin-bottom: 5px;
        font-size: 13.5px;
        font-weight: 500;
        color: #555;
        letter-spacing: 0.2px;
    }

    .option-item select {
        width: 100%;
        padding: 10px;
        border: none;
        border-radius: 8px;
        background-color: white;
        box-shadow: inset 0 2px 10px rgba(0,0,0,0.03);
        font-size: 14px;
        font-weight: 400;
        letter-spacing: 0.2px;
        color: #2c3e50;
    }

    .slider-with-input {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .slider-with-input input[type="number"] {
        width: 60px;
        padding: 4px 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
        font-weight: 400;
        letter-spacing: 0.2px;
    }

    .slider-with-input .slider-container {
        flex: 1;
    }

    .slider-container input[type="range"] {
        width: 100%;
        margin: 0;
        height: 6px;
        background: #e0e0e0;
        border-radius: 3px;
        -webkit-appearance: none;
    }

    .slider-container input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 18px;
        height: 18px;
        background: linear-gradient(135deg, #4568dc, #b06ab3);
        border-radius: 50%;
        cursor: pointer;
    }

    #media {
        position: relative;
        width: 100%;
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    #media video {
		position: relative;
		width: 100%;
		height: auto;
        background: #f2f2f2;
        border-radius: 12px;
		overflow: hidden; /* 隐藏超出部分 */
    }

    .theme-toggle {
        position: absolute;
        top: 20px;
        right: 20px;
        z-index: 1000;
    }

    .theme-toggle button {
        background: none;
        border: none;
        cursor: pointer;
        padding: 8px;
        border-radius: 50%;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .theme-toggle button i {
        font-size: 20px;
    }

    /* 修改图标颜色 */
    .theme-toggle button i.fa-moon {
        color: #4568dc;
    }

    .theme-toggle button i.fa-sun {
        color: #ffd700;
    }

    /* 悬停效果 */
    .theme-toggle button:hover {
        background-color: rgba(0, 0, 0, 0.1);
        transform: scale(1.1);
    }

    /* 暗色主题样式 */
    body.dark-mode {
        background-color: #1a1a1a;
    }

    .dark-mode .outer-container {
        background: #2d2d2d;
        box-shadow: 0 8px 30px rgba(0,0,0,0.2);
    }

    .dark-mode .panel {
        background-color: #383838;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }

    .dark-mode .chat-container {
        background-color: #2d2d2d;
        box-shadow: inset 0 2px 10px rgba(0,0,0,0.2);
    }

    .dark-mode .message-content {
        color: #e0e0e0;
    }

    .dark-mode .user-message .message-content {
        background-color: #4568dc;
        color: #fff;
    }

    .dark-mode .bot-message .message-content {
        background-color: #454545;
        color: #fff;
    }

    .dark-mode .input-panel {
        background-color: #383838;
    }

    .dark-mode .input-panel textarea {
        background-color: #f2f2f2;
        color: #e0e0e0;
    }

    .dark-mode .options-container {
        background-color: #383838;
    }

    .dark-mode .option-item label {
        color: #e0e0e0;
    }

    .dark-mode .option-item select {
        background-color: #2d2d2d;
        color: #e0e0e0;
    }

    .dark-mode .welcome-message {
        background-color: #383838;
        color: #e0e0e0;
    }

    /* 在暗色主题样式部分添加滚动条样式 */
    .dark-mode .chat-container::-webkit-scrollbar {
        width: 8px;
    }

    .dark-mode .chat-container::-webkit-scrollbar-track {
        background: #2d2d2d;
        border-radius: 4px;
    }

    .dark-mode .chat-container::-webkit-scrollbar-thumb {
        background: #4a4a4a;
        border-radius: 4px;
    }

    .dark-mode .chat-container::-webkit-scrollbar-thumb:hover {
        background: #555555;
    }

    /* 同时也为日间模式添加美化的滚动条样式 */
    .chat-container::-webkit-scrollbar {
        width: 8px;
    }

    .chat-container::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 4px;
    }

    .chat-container::-webkit-scrollbar-thumb {
        background: #c1c1c1;
        border-radius: 4px;
    }

    .chat-container::-webkit-scrollbar-thumb:hover {
        background: #a8a8a8;
    }

    /* 在暗色主题样式部分添加以下代码 */
    .dark-mode .slider-with-input input[type="number"] {
        background-color: #2d2d2d;
        border: 1px solid #454545;
        color: #e0e0e0;
    }

    .dark-mode .slider-container input[type="range"] {
        background: #454545;
    }

    .dark-mode .slider-container input[type="range"]::-webkit-slider-thumb {
        background: linear-gradient(135deg, #4568dc, #b06ab3);
        box-shadow: 0 0 5px rgba(0,0,0,0.3);
    }

    /* 为滑块添加悬停效果 */
    .dark-mode .slider-container input[type="range"]::-webkit-slider-thumb:hover {
        transform: scale(1.1);
    }

    /* 为数字输入框添加焦点效果 */
    .dark-mode .slider-with-input input[type="number"]:focus {
        outline: none;
        border-color: #4568dc;
        box-shadow: 0 0 5px rgba(69, 104, 220, 0.3);
    }

	.control-panel {
      display: none; /* 这将隐藏整个 control-panel div */
    }
	
	/*-------------------------------------------------------------修改部分------------------------------------------------------------*/
	
	/*上半部分整体布局*/
	.container {
	    display: flex;
	    padding: 0;
	    max-width: none;
	    margin: 0;
	    align-items: stretch;
	}
	
	.container form {
	    display: flex;
	    width: 100%;
	    gap: 8px;
	    align-items: flex-start;
	}
	
	.container textarea {
	    flex: 1;
	    border: none;
	    border-radius: 8px;
	    padding: 8px 12px;
	    background-color: #f2f2f2;
	    font-size: 14.5px;
	    letter-spacing: 0.2px;
	    font-weight: 500;
	    height: 30px;
	    max-height: 25px;
	    resize: none;
	    line-height: 1.5;
	    white-space: nowrap;
	    overflow-x: auto;
	    overflow-y: hidden;
	}
	
	.container button {
	    height: 35px;
	    border-radius: 8px;
	    border: none;
	    background: transparent;
	    color: white;
	    cursor: pointer;
	    transition: all 0.3s ease;
	    width: 30px;
	    display: flex;
	    align-items: center;
	    justify-content: center;
	    white-space: nowrap;
	}
	
	.container button:hover {
	    background: transparent;
	    transform: translateY(-1px);
	}
	
	/*板块布局*/
	.panel-left{
		flex: 50%;
		border: none;
		border-radius: 16px 0px 0px 16px;
		background-color: #f2f2f2;
		box-shadow: 0 4px 15px rgba(0,0,0,0.05);
		transition: all 0.3s ease;
		display: flex;
		flex-direction: column;
		overflow: hidden;
		position: relative;
	}
	
	.panel{
		flex: 50%;
		border: none;
		border-radius: 0px 16px 16px 0px;
		background-color: #f2f2f2;
		box-shadow: 0 4px 15px rgba(0,0,0,0.05);
		transition: all 0.3s ease;
		display: flex;
		flex-direction: column;
		overflow: hidden;
	}
	
	.panel-left:hover{
		transform: translateY(-2px);
		box-shadow: 0 6px 20px rgba(0,0,0,0.08);
	}
	
	.panel:hover {
	    transform: translateY(-2px);
	    box-shadow: 0 6px 20px rgba(0,0,0,0.08);
	}
	
	/*左侧内容布局*/
	.form-inline{
		display: flex;
		padding: 10px;
		flex-direction: row;
		align-items: center;
		justify-content: center;
		height: 50px;
		border-top: 1px solid #e1e1e1;
	}
	
	.form-inline .gap{
		background-color: #e1e1e1;
		width: 1px;
		height: 40px;
	}
	
	.panel.image{
		display: flex;
		align-items: center;
		justify-content: center;
	}
	
	.panel .form-inline img{
		margin-left: 10px;
		margin-top: 10px;
		margin-right: 20px;
		width: 20px;
		height: 20px;
	}
	
	.submit{
		width: 50px;
		height: 50px;
	}
	
	.form-control {
	    max-width: 350px; /* 最大宽度 */
	}
	
	.more{
		width: 50px;
		height: 50px;
	}
	
	.input-panel{
		display: none;
	}
	
	/*左上表示栏*/
	.demo{
		position: absolute;
		left: 10px;
		top:10px;
		font-size: 30px;
		font-weight: 700;
		display: flex;
		align-items: center;
		justify-content: center;
		margin:0px 15px;
		z-index: 100;
	}
	
	.tips{
		margin-left: 5px;
		margin-top: 5px;
		text-align: center;
		width: 50px;
		font-size: 16px;
		font-weight: 500;
		color: #7e7e7e;
		background-color:white;
		border-radius: 50px;
	}
	
	/*右下标签栏*/
	.bottom-icon{
		display: flex;
		align-items: center;
		justify-content: center;
		font-size: 20px;
		font-weight: 600;
		position: absolute;
		left: 480px;
		top:1025px;
		z-index: 10;
	}
	
	.bottom-icon img{
		width: 30px;
		height: 30px;
	}
	
	
	/*选项卡组*/
	#options-container {
		transition: all 1s ease;
	    display: none; /* 初始时隐藏 */
	    flex-direction: column; /* 垂直排列子元素 */
		align-items: center;
		justify-content: center;
	    margin-top: 10px; /* 与输入框保持一定距离 */
		padding: 10px;
		border-top: 1px solid #e6e6e6;
	}
	
	.options-group {
	    display: flex; /* 使用flex布局 */
	    align-items: center; /* 垂直居中对齐 */
		justify-content: center;
		gap: 20px;
	    margin-bottom: 5px; /* 每个选项之间的间距 */
	}
	
	.option-item{
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		margin: 0px 10px;
		width: 100px;
		
	}
	
	.img_container img{
		height: 38px;
		width: 38px;
	}
	
	.img_container{
		display: flex;
		align-items: center;
		justify-content: center;
		height: 80px;
		width: 80px;
		background-color: #d9d9d9;
		border-radius: 12px;
		transition: all 0.3s; /* 平滑背景颜色变化 */
	}
	
	.img_container.selected {
	    background-color: white; /* 选中时的背景颜色 */
	}
	
	.option-line{
		display: flex;
		flex-direction: row;
		align-items: center;
		justify-content: center;
		margin-top: 10px;
		width: 100%;
		height: 50px;
	}
	
	
	/*语音改变功能*/
	#voice-image {
	    transition: opacity 0.3s ease-in-out; /* 平滑过渡效果 */
	    display: block; /* 确保图片是块级元素 */
	}
	
	#voice-image.changing {
	    opacity: 0; /* 当图片正在变化时，透明度变为0 */
	}
	
	
	/* 轮播选择部分 */
	#banner-container{
		display: block;
		visibility: hidden; /* 初始不可见 */
		z-index: 100;
	    width: 100%;
	    position: absolute;
		top: 850px;
	    height: 250px;
		overflow: hidden; /* 确保图片不会超出容器 */
		opacity: 0; /* 初始透明度 */
		transition: all 1s ease; /* 定义过渡效果 */
	}
	
	#banner-container.show {
		opacity: 1; /* 完全不透明 */
		visibility: visible; /* 可见 */
	}
	
	
	#banner-container #banner ul{
	    list-style: none;
	    padding-left: 0;
		display: flex; /* 使li元素水平排列 */
		justify-content: center; /* 水平居中对齐 */
		align-items: center; /* 垂直居中对齐 */
		transition: transform 0.5s ease; /* 平滑过渡效果 */
	}
	
	#banner-container #banner ul li{
		position: relative; /* 改为相对定位 */
		display: inline-block; /* 或者使用 flex 布局 */
		margin-right: 10px; 
	}
	
	#banner-container #banner ul li img{
	    width: 80px;
	    height: 100px;
	    border-radius: 12px;
	    display: block;
	}
	/* 为每个图片设置不同的 left 值 */
	#banner0 {
	    left: 250px;
	}
	
	#banner1 {
		left: 230px;
	}
	
	#banner2 {
		left: -100px;
	}
	
	#banner3 {
	    left: -310px;
	}
	
	#banner4 {
	   left: -50px;
	}

	#banner-container #nexImg, #banner-container #preImg {
	    position: absolute;
	    opacity: 0.5;
	    top: 30%; /* 保持顶部位置不变 */
	    z-index: 10;
	    transform: translateY(-50%); /* 垂直居中 */
	}
	
	#banner-container #preImg {
	    left: 50px; /* 向左移动较少的距离 */
	    transform: translate(-50%, -50%); /* 水平和垂直居中 */
	}
	
	#banner-container #nexImg {
	    left:455px; /* 向右移动较少的距离 */
	    transform: translate(50%, -50%); /* 水平和垂直居中 */
	}
	#banner-container #nexImg img ,#banner-container #preImg img 
	{
	    width: 20px;
	    height: 20px;
	    opacity: 0.8;
	}
	#banner-container #nexImg{
	    right: 0;
	}
	#banner-container #nexImg:hover,#banner-container #preImg:hover{
	    cursor: pointer;
	    opacity: 0.5;
	}
	#banner-container .jumpBtn{
	    position: absolute;
	    bottom: 10px;
	    left: 45%;
	}
	#banner-container .jumpBtn ul{
	    margin-bottom:0;
	    padding: 0;
	    list-style: none;
	}
	#banner-container .jumpBtn ul li{
	    font-size: 12px;
	    text-align: center;
	    display: inline-block;
	    width: 15px;
	    height: 15px;
	    border-radius: 50px;
	    opacity: 0.4;
	}
	
	.stableFrist{
		display: block;
		width: 100%;
		height: 250px;
		transition: all 2s; /* 只对 transform 属性应用过渡效果 */
		 transform: scale(1.1) translateZ(100px);
	}
	
	.on{
		border: 5px solid white; /* 白色边框 */
		transition: border 2s; /* 单独为边框添加过渡效果 */
	}
	
	.out{
	    display: block;
	    width: 100%;
	    height: 250px;
	    transition: all 2s;
		transform: scale(0.9) translateZ(-50px); /* 缩小并向后位移 */
	}
	
	.out_2{
		display: block;
		width: 100%;
		height: 250px;
		transition: all 2s;
		transform: scale(0.7) translateZ(-50px); /* 缩小并向后位移 */
	}
	/* 更多的CSS样式可以根据需要进行添加，以确保视觉效果符合设计要求。 */
	
    </style>
</head>
<body>

<div class="outer-container">
    <!-- <div class="main-title">
        <h1>2WAI Demo</h1>
        <div class="theme-toggle">
            <button id="theme-toggle-btn">
                <i class="fas fa-moon"></i>
            </button>
        </div>
    </div> -->

    <div class="container">

        <!-- z左侧视频面板 -->
        <div class="panel-left">
			
            <div class="control-panel">
                <div class="option">
                    <input id="use-stun" type="checkbox" checked/>
                    <label for="use-stun">Use STUN server</label>
                </div>
            </div>

			<!-- 视频展示区 -->
            <div id="media">
				<div class="demo">
					2WAI
					<div class="tips">
						Demo
					</div>
				</div>
				
                <audio id="audio" autoplay="true"></audio>
                <!-- <video id="video" autoplay="true" playsinline="true" src="base.mp4"></video> -->
				<video id="video" autoplay playsinline loop muted>
				  <source src="./video/base.mp4" type="video/mp4">
				  
				</video>
				
				<div class="bottom-icon">
					Zoom
					<img src="./icon/move.png" alt="" />
				</div>
				
				<!-- 自定义更换区 -->
				<div id="banner-container">
				    <div id = "banner">
				        <ul>
				            <li id = "banner0"  class="stableFrist">
				                <img src="./icon/defaultBackground.jpg" id="img1">
				            </li>
				            <li id = "banner1" class="out">
				                <img src="./icon/background2.png" id="img2">
				            </li>
				            <li id = "banner2" class="out">
				                <img src="./icon/background3.png" id="img3">
				            </li>
							<li id = "banner3" class="out_2">
							    <img src="./icon/background4.png" id="img4">
							</li>
							<li id = "banner4" class="out_2">
							    <img src="./icon/background5.png" id="img5">
							</li>
				        </ul>
				    </div>
				
				    <div id = "nexImg">  <!--向右的箭头-->
				        <img src="./icon/nexImg.png">
				    </div>
				
				    <div id = "preImg"> <!--向左的箭头-->
				        <img src = "./icon/preImg.png">
				    </div>
				</div>
				
				
            </div>

			
        </div>

        <!-- 右侧聊天面板 -->
        <div class="panel">
			
            <div class="chat-container" id="chat-messages">
                <div class="welcome-message">
                    <span>Welcome! You can cdivck the <img src="./icon/voice.png" alt="" /> icon below or enter text to talk to me</span>
                </div>
                <!-- 聊天消息将在这里动态添加 -->
            </div>
			
			<form class="form-inline" id="echo-form">
				
				<div id="image-container">
				    <img id="voice-image" src="./icon/voice.png" alt="voice" onclick="changeImage()" />
				</div>
				<div class="gap"></div> 	<!-- 间隔竖线 -->
			    <textarea class="form-control" id="message" placeholder="Type your message here..."></textarea>
				<img id="microphone-icon" src="./icon/microphone.png" alt="microphone" style="display:none;" />
				<!-- 按钮包裹的提交 -->
			   <button type="submit" class="btn btn-default" onclick="start()">
				   <img class="submit" src="./icon/submit.png" alt="submit" />
			   </button>
			   <div class="gap"></div>		<!-- 间隔竖线 -->
			   
			   <div class="more">
				   <img src="./icon/more.png" alt="" />
			   </div>
			   
			</form>
			
			<!-- 隐藏式选择框 -->
			<div id="options-container">
			     <div class="options-group">
			         <div class="option-item">
						 <div class="img_container">
							 <img id="avatar-name" src="./icon/Digital Human.png" alt="" />
						 </div>
			             <label for="avatar-name">Digital Human</label>
			         </div>
			     
			         <div class="option-item">
						 <div class="img_container">
						 	<img src="./icon/cude.png" alt="" id="tts-selection"/>
						 </div>
						 
			             <label for="tts-selection">TTS Selection</label>
			         </div>
			     
			         <div class="option-item">
						 <div class="img_container">
						 	<img id="avatar-voice" src="./icon/voiceLine.png" alt="" />
						 </div>
			             <label for="avatar-voice">TTS Sound</label>
			         </div>
					 
					 <div class="option-item">
					 	 <div class="img_container" id="avatar-background">
					 	 	<img src="./icon/background.png" alt="" />
					 	 </div>
					     <label for="avatar-background">background</label>
					 </div>
					 
			     </div>
				 
				 <!-- 拖拉调节条 -->
				 <div class="option-line">
					<label for="chunk-size">Min Length:</label>
					<div class="slider-with-input">
					    <input type="number" id="chunk-size-input" class="form-control" min="0" max="30" value="10">
					    <div class="slider-container">
					        <input type="range" id="chunk-size" class="form-control" min="0" max="30" step="1" value="10">
					    </div>
					</div>
				 </div>
				 
			 </div>
			
        </div>
		
		
    </div>

    <div class="input-panel">
        <button type="button" id="start" onclick="start()">Start</button>
        <button type="button" id="stop" style="display: none" onclick="stop()">Stop</button>
        <input type="hidden" id="sessionid" value="0">
    </div>
	
	<div>
	    <label for="btn-record"></label>
	    <button class="btn btn-primary" id="btn_start_record">Start Recording</button>
	    <button class="btn btn-primary" id="btn_stop_record" disabled>Stop Recording</button>
	</div>
	
</div>


</body>



<script src="client_wn.js"></script>
<!-- <script type="text/javascript" src="http://cdn.sockjs.org/sockjs-0.3.4.js"></script> -->
<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>

<script>
	//DDsheng修改的	
	document.addEventListener('DOMContentLoaded', function() {
	    // 获取 'avatar-background' 元素
	    var avatarBackground = document.getElementById('avatar-background');
	
	    // 获取轮播区域元素
	    var bannerContainer = document.getElementById('banner-container');
	
	    // 为 'avatar-background' 添加点击事件监听器
	    avatarBackground.addEventListener('click', function() {
	        // 检查是否已经显示，如果显示则隐藏，否则显示
	        if (bannerContainer.classList.contains('show')) {
	            bannerContainer.classList.remove('show');
	        } else {
	            bannerContainer.classList.add('show');
	        }
	    });
		
	});

	/*隐藏框的展示*/
	$('.more').click(function() {
			
		// 获取轮播区域元素
		var bannerContainer = document.getElementById('banner-container');
		// 检查是否已经显示，如果显示则隐藏，否则显示
		if (bannerContainer.classList.contains('show')) {
		    bannerContainer.classList.remove('show');
		}
		
	    $('#options-container').toggle(); // 使用 jQuery 的 toggle 方法来切换显示和隐藏
	});
	
	var videoElement = document.getElementById('video');
	
	 videoElement.addEventListener('ended', function() {
	    // 更换视频源为 base.mp4 并设置循环播放
	    videoElement.src = './video/base.mp4';
	    videoElement.loop = true; 
	    videoElement.play(); // 播放新视频
	});
	
	/*功能元素选中*/
	$(document).ready(function() {
	    // 功能元素选中
	    $('.option-item').click(function() {
			
			var bannercontainerElement = document.getElementById('bannercontainer');
	        var imgContainer = $(this).find('.img_container');
			
	        if (imgContainer.hasClass('selected')) {
	            imgContainer.removeClass('selected');
	        } else {
	            $('.img_container').removeClass('selected');
	            imgContainer.addClass('selected');
	        }
			
	    });

	    var bannerContainer = document.getElementById('banner-container');
	    
	    // 点击文档其他区域时重置所有 .img_container 的选中状态
	    $(document).click(function(event) {
	        // 检查点击的目标是否在轮播区域内
	        if (!bannerContainer.contains(event.target) && !$(event.target).closest('.option-item').length) {
	            $('.img_container').removeClass('selected');
	        }
	    });
	});

	
	/*声音切换*/
	var voiceFlag = true; 
	
	function changeImage() {
	    // 获取图片元素
	    var image = document.getElementById('voice-image');
		
		voiceFlag=!voiceFlag;
	    var newSrc =voiceFlag? './icon/voice.png' : './icon/left.png'; // 根据 voiceFlag 的值选择图片
	
	    // 添加过渡效果
	    image.classList.add('changing');
	
	    // 移除过渡效果类，这将在 CSS 中触发过渡
	    setTimeout(function() {
			// 设置图片新源
			image.src = newSrc;
	        image.classList.remove('changing');
	    }, 300); // 300毫秒后移除，与 CSS 中的过渡时间相匹配
	}
	
</script>


<script>
// 背景选择部分

	const API_URL = '/generate-video';

	// 当用户选择一张照片时，获取照片的URL
	function getCurrentImageSrc() {
	    const selectedImage = document.getElementById(`banner${curImg}`).querySelector('img');
	    console.log(selectedImage.src);
	}
	
	// 调用接口并处理响应
	function callApiWithImage(imageSrc) {
	    fetch(API_URL, {
	        method: 'POST',
	        headers: {
	            'Content-Type': 'application/json'
	        },
	        body: JSON.stringify({ image: imageSrc }) // 将图片URL作为JSON对象传递
	    })
	    .then(response => response.json())
	    .then(data => {
	        // 假设服务器返回的视频URL在data.videoUrl属性中
	        const videoUrl = data.videoUrl;
	        // 更新页面上的视频元素的src属性
	        const videoElement = document.getElementById('video');
	        videoElement.src = videoUrl;
	        videoElement.play();
	    })
	    .catch(error => {
	        console.error('Error:', error);
	    });
	}

    //记录当前的位置
    var curImg = 0;
    //获取轮播图照片的个数
    var imgLength = document.getElementById("banner").getElementsByTagName("li").length
	console.log(imgLength);
    // var time = setInterval(bannerImg,3000);
    //轮播图
    function bannerImg(){
        if(curImg<imgLength-1){
            curImg++;
        }else{
			document.getElementById("banner"+curImg).setAttribute("class","out_2");
            curImg = 0;
        }
		
		const currentImageSrc = getCurrentImageSrc();
		
        document.getElementById("banner"+curImg).setAttribute("class","stableFrist");
        if(curImg-1==0){
            document.getElementById("banner"+(curImg-1)).setAttribute("class","out");
        }else if(curImg-1==1||curImg-1==2){
            document.getElementById("banner"+(curImg-1)).setAttribute("class","out");
        }else if(curImg-1==3||curImg-1==4){
			document.getElementById("banner"+(curImg-1)).setAttribute("class","out_2");
		}
    }
	
    //点击下一张
    document.getElementById("nexImg").onclick = function(){
        //清除时间定时器
        // clearInterval(time);
		
        bannerImg();
		
        // time = setInterval(bannerImg,3000);
    }
	
    //点击上一张
    document.getElementById("preImg").onclick = function(){
        // clearInterval(time);
        if(curImg==0)
        {
            curImg = imgLength-1;
        }else{
            curImg--;
        }
		
		const currentImageSrc = getCurrentImageSrc();
		
        document.getElementById("banner"+curImg).setAttribute("class","stableFrist");
		
        if(curImg==imgLength-1)
        {
            document.getElementById("banner"+0).setAttribute("class","out");
        }else if(curImg+1==3||curImg+1==4){
            document.getElementById("banner"+(curImg+1)).setAttribute("class","out_2");
        }else if(curImg+1==1||curImg+1==2){
            document.getElementById("banner"+(curImg+1)).setAttribute("class","out");
		}
        // time = setInterval(bannerImg,3000)
    }
	
</script>
       

<script type="text/javascript" charset="utf-8">
	
	
	
	$(document).ready(function() {
	  // var host = window.location.hostname
	  // var ws = new WebSocket("ws://"+host+":8000/humanecho");
	  // //document.getElementsByTagName("video")[0].setAttribute("src", aa["video"]);
	  // ws.onopen = function() {
		// console.log('Connected');
	  // };
	  // ws.onmessage = function(e) {
		// console.log('Received: ' + e.data);
		// data = e
		// var vid = JSON.parse(data.data); 
		// console.log(typeof(vid),vid)
		// //document.getElementsByTagName("video")[0].setAttribute("src", vid["video"]);
		
	  // };
	  // ws.onclose = function(e) {
		// console.log('Closed');
	  // };
	  
	

	  function addMessage(message, isUser) {
        const messageDiv = $('<div>')
            .addClass('message')
            .addClass(isUser ? 'user-message' : 'bot-message');
        
        const avatar = $('<img>')
            .addClass('message-avatar')
            .attr('src', './icon/icon.png')
            .attr('alt', isUser ? 'User' : 'Bot');
        
        const content = $('<div>')
            .addClass('message-content')
            .text(message);
        
        messageDiv.append(avatar).append(content);
        $('#chat-messages').append(messageDiv);
        $('#chat-messages').scrollTop($('#chat-messages')[0].scrollHeight);
    }

	  $('#echo-form').on('submit', function(e) {
      e.preventDefault();
      var message = $('#message').val();
      // 添加用户消息到聊天框
      addMessage(message, true);
      
      console.log('Sending: ' + message);
      console.log('sessionid: ',document.getElementById('sessionid').value);
      fetch('/human', {
            body: JSON.stringify({
                text: message,
                type: 'chat',
                interrupt: true,
                sessionid:parseInt(document.getElementById('sessionid').value),
                avatarName:document.getElementById('avatar-name').value,
                ttsSelection:document.getElementById('tts-selection').value,
                avatarVoice:document.getElementById('avatar-voice').value,
                chunkSize:document.getElementById('chunk-size').value
            }),
            headers: {
                'Content-Type': 'application/json'
            },
            method: 'POST'
      })
      .then(response => response.json())
      .then(data => {
          // 添加机器人的回复消息
          const llmResponse = data.res || "No valid response was returned！";
          addMessage(llmResponse, false);
      })
      .catch(error => {
          console.error('Error:', error);
          // 可选：显示错误消息
          addMessage("Sorry, an error occurred. Please try again later.", false);
      });
      
      // 清空入框并将焦点重新放在输入框上
      $('#message').val('');
	  });

    $('#btn_start_record').click(function() {
        // 开始录制
        console.log('Starting recording...');
        fetch('/record', {
            body: JSON.stringify({
                    type: 'start_record',
                }),
                headers: {
                    'Content-Type': 'application/json'
                },
            method: 'POST'
        }).then(function(response) {
            if (response.ok) {
                console.log('Recording started.');
                $('#btn_start_record').prop('disabled', true);
                $('#btn_stop_record').prop('disabled', false);
                // $('#btn_download').prop('disabled', true);
            } else {
                console.error('Failed to start recording.');
            }
        }).catch(function(error) {
            console.error('Error:', error);
        });
    });

    $('#btn_stop_record').click(function() {
        // 结束录制
        console.log('Stopping recording...');
        fetch('/record', {
            body: JSON.stringify({
                    type: 'end_record',
                }),
                headers: {
                    'Content-Type': 'application/json'
                },
            method: 'POST'
        }).then(function(response) {
            if (response.ok) {
                console.log('Recording stopped.');
                $('#btn_start_record').prop('disabled', false);
                $('#btn_stop_record').prop('disabled', true);
                // $('#btn_download').prop('disabled', false);
            } else {
                console.error('Failed to stop recording.');
            }
        }).catch(function(error) {
            console.error('Error:', error);
        });
    });

    // $('#btn_download').click(function() {
    //     // 载视频文件
    //     console.log('Downloading video...');
    //     fetch('/record_lasted.mp4', {
    //         method: 'GET'
    //     }).then(function(response) {
    //         if (response.ok) {
    //             return response.blob();
    //         } else {
    //             throw new Error('Failed to download the video.');
    //         }
    //     }).then(function(blob) {
    //         // 创建一个 Blob 对象
    //         const url = window.URL.createObjectURL(blob);
    //         // 创建一个藏的可下载链接
    //         const a = document.createElement('a');
    //         a.style.display = 'none';
    //         a.href = url;
    //         a.download = 'record_lasted.mp4';
    //         document.body.appendChild(a);
    //         // 触发下载
    //         a.click();
    //         // 清理
    //         window.URL.revokeObjectURL(url);
    //         document.body.removeChild(a);
    //         console.log('Video downloaded successfully.');
    //     }).catch(function(error) {
    //         console.error('Error:', error);
    //     });
    // });

	});
</script>

<script>
    // 在现有的 JavaScript 代码中添加
    async function loadOptions() {
        const response = await fetch('options.json');
        const options = await response.json();
        window.appConfig = options;

        // 填充 Digital Human 选项框
        const avatarSelect = document.getElementById('avatar-name');
        options.avatars.forEach(avatar => {
            const option = document.createElement('option');
            option.value = avatar.value;
            option.textContent = avatar.label;
            avatarSelect.appendChild(option);
        });

        // 填充 TTS Selection 选择框
        const ttsSelect = document.getElementById('tts-selection');
        options.ttsModules.forEach(tts => {
            const option = document.createElement('option');
            option.value = tts.value;
            option.textContent = tts.label;
            ttsSelect.appendChild(option);
        });

        // 填充 TTS Sound 选择框
        const voiceSelect = document.getElementById('avatar-voice');
        options.ttsVoices.forEach(voice => {
            const option = document.createElement('option');
            option.value = voice.value;
            option.textContent = voice.label;
            voiceSelect.appendChild(option);
        });

        // 设置默认选中项
        if (options.avatars.length > 0) {
            avatarSelect.value = options.avatars[0].value;
        }
        if (options.ttsModules.length > 0) {
            ttsSelect.value = options.ttsModules[0].value;
        }
        if (options.ttsVoices.length > 0) {
            voiceSelect.value = options.ttsVoices[0].value;
        }
    }

    // Initialize options
    loadOptions();

    // 同步滑块和输入框的值
    const chunkSizeSlider = document.getElementById('chunk-size');
    const chunkSizeInput = document.getElementById('chunk-size-input');

    chunkSizeSlider.addEventListener('input', function(e) {
        chunkSizeInput.value = e.target.value;
    });

    chunkSizeInput.addEventListener('input', function(e) {
        let value = parseInt(e.target.value);
        if (value < 0) value = 0;
        if (value > 30) value = 30;
        if (!isNaN(value)) {
            chunkSizeSlider.value = value;
        }
    });
</script>
<!-- <script type="text/javascript">
    window.addEventListener('load', () => {
      // 确保页面加载完毕后执行
      const startButton = document.getElementById('start');
      if (startButton) {
        startButton.click(); // 触发点击事件
      }
    });
</script> -->

<script>
    const themeToggleBtn = document.getElementById('theme-toggle-btn');
    const themeIcon = themeToggleBtn.querySelector('i');

    // 检查本地存储中的主题设置
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'dark') {
        document.body.classList.add('dark-mode');
        themeIcon.classList.replace('fa-moon', 'fa-sun');
    }

    themeToggleBtn.addEventListener('click', () => {
        document.body.classList.toggle('dark-mode');
        
        // 更新图标
        if (document.body.classList.contains('dark-mode')) {
            themeIcon.classList.replace('fa-moon', 'fa-sun');
            localStorage.setItem('theme', 'dark');
        } else {
            themeIcon.classList.replace('fa-sun', 'fa-moon');
            localStorage.setItem('theme', 'light');
        }
    });
</script>
<script>
    // 添加视频高度监听和聊天容器高度整功能
    function adjustChatContainerHeight() {
        const video = document.querySelector('#video');
        const chatContainer = document.querySelector('.chat-container');
        const form = document.querySelector('#echo-form'); // 确保你的表单有一个ID
    
        if (video && chatContainer && form) {
            const videoHeight = video.offsetHeight;
            const formHeight = form.offsetHeight;
            const adjustedHeight = videoHeight - formHeight - 50px;
    
            if (adjustedHeight > 0) {
                chatContainer.style.height = `${adjustedHeight}px`;
                chatContainer.style.minHeight = `${adjustedHeight}px`;
                chatContainer.style.maxHeight = `${videoHeight}px`; // 你可以根据需要调整最大高度
            } else {
                // 如果计算出的高度小于或等于0，你可以设置一个最小高度或者直接使用视频的高度
                chatContainer.style.height = `${videoHeight}px`;
                chatContainer.style.minHeight = `${videoHeight}px`;
                chatContainer.style.maxHeight = `${videoHeight}px`;
            }
        }
    }
    
    // 监听视频加载事件
    document.querySelector('#video').addEventListener('loadedmetadata', () => {
        setTimeout(adjustChatContainerHeight, 100); // 迟一点执行以确保视频尺寸已更新
    });
    
    // 创建 ResizeObserver 来监听视频尺寸变化
    const resizeObserver = new ResizeObserver(entries => {
        adjustChatContainerHeight();
    });
    
    // 开始观察视频元素
    resizeObserver.observe(document.querySelector('#video'));
    
    // 监听窗口大小变化
    window.addEventListener('resize', adjustChatContainerHeight);
    
    // 定期检查视频高度（以防其他情况导致的变化）
    setInterval(adjustChatContainerHeight, 1000);
</script>
</html>
